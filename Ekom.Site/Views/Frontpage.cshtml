@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using Ekom.API;

@{
    Layout = "Masterpage.cshtml";

    var products = new List<Ekom.Models.Product>();
    var currentStore = Store.Current.GetStore();
    var alias = "";
    Ekom.Models.OrderInfo order = null;

    if (currentStore != null)
    {
        alias = currentStore.Alias;
        order = Order.Current.GetOrder(alias);
        products = Catalog.Current.GetAllProducts().ToList();
    }

}

@section Main {

    <div class="row column text-center">
        <div>

        <h3>@currentStore.Alias</h3>
            <h2>
                Our Newest Products - Store : @alias - Product: @products.Count() - Domain:
                @(UmbracoContext.PublishedContentRequest.UmbracoDomain != null ? UmbracoContext.PublishedContentRequest.UmbracoDomain.DomainName : "null")
            </h2>         

            @if (currentStore != null)
            {
                <h4>Store</h4>
                <br />
                <span>Culture:</span> @currentStore.Culture.Name
                    <br />
                    <span>Vat:</span> @currentStore.Vat
                    <br />
                    <span>Include Vat In Price:</span> @currentStore.VatIncludedInPrice
                    <br />
            }


            <h4>Order</h4>

            Order: @(order != null ? "Found" : "Empty")

            @if (order != null)
            {
                <div>ReferenceId: @order.ReferenceId</div>
                <div>OrderNumber: @order.OrderNumber</div>
                <div>Store: @order.StoreInfo.Alias</div>
                <div>Quantity: @order.Quantity</div>
                <div>Status: @order.OrderStatus</div>
                <div>Total: @order.ChargedAmount.ToCurrencyString()</div>

                if (order.OrderLines.Any())
                {
                    <ul>
                        @foreach (var line in order.OrderLines)
                        {
                            <li><a href="#" data-store="@order.StoreInfo.Alias" data-lineId="@line.Id" class="order-remove-line">Remove</a> @line.Id - @line.Quantity - @(line.Product != null ? line.Product.Title : "") - @(line.Product != null ? line.Product.SKU : "") - @line.Amount.WithVat.ToCurrencyString()
    

                                @if (line.Product.VariantGroups.Any())
                                {
                                    foreach (var group in line.Product.VariantGroups)
                                    {
                                        <h4>@group.Title - @group.Id</h4>

                                        <ul>
                                            @foreach (var variant in group.Variants)
                                            {
                                                <li>@variant.Id - @variant.Title</li>
                                            }
                                        </ul>
                                    }

                                }
                            </li>
                        }
                    </ul>
                }
            }

        </div><hr></div><div class="row small-up-2 large-up-4">

        @foreach (var product in products)
        {
            <div class="column">
                <img class="thumbnail" src="http://placehold.it/300x400">
                <h5>@product.Title</h5>

                <p>Price With Vat : @product.Price.WithVat.Value</p>
                <p>Price WithOut Vat : @product.Price.WithoutVat.Value</p>
                <p>Price Original : @product.Price.Value</p>

                <a href="@product.Url" class="button expanded">View</a>

                <form method="post" action="/umbraco/surface/Ekom/order/addtoOrder" class="add-to-order">
                    <input type="hidden" name="productId" value="@product.Key" />
                    <input type="hidden" name="variantId" value="@Guid.Empty" />
                    <input type="hidden" name="storeAlias" value="@currentStore.Alias" />
                    <input type="hidden" name="action" value="@Ekom.Helpers.OrderAction.Update" />

                    @if (product.VariantGroups.Any())
                    {
                        foreach (var group in product.VariantGroups.Where(x => x.Variants.Any()))
                        {
                            <h5>@group.Title</h5>

                            <select name="variantId">
                                @foreach (var variant in group.Variants)
                                {
                                    <option value="@variant.Key">@variant.Title</option>
                                }
                            </select>

                        }
                    }
                    <input type="number" name="quantity" value="1" />

                    <button type="submit" class="button expanded">Add to cart</button>
                </form>

            </div>
        }

    </div>

    <hr>

    <div class="row column">
      <div class="callout primary">
        <h3>Really big special this week on items.</h3>
      </div>
    </div>

    <hr>

    <div class="row column text-center">
      <h2>Some Other Neat Products</h2>
      <hr>
    </div>

    <div class="row small-up-2 medium-up-3 large-up-6">
      <div class="column">
        <img class="thumbnail" src="http://placehold.it/300x400">
        <h5>Nulla At Nulla Justo, Eget</h5>
        <p>$400</p>
        <a href="#" class="button small expanded hollow">Buy</a>
      </div>
      <div class="column">
        <img class="thumbnail" src="http://placehold.it/300x400">
        <h5>Nulla At Nulla Justo, Eget</h5>
        <p>$400</p>
        <a href="#" class="button small expanded hollow">Buy</a>
      </div>
      <div class="column">
        <img class="thumbnail" src="http://placehold.it/300x400">
        <h5>Nulla At Nulla Justo, Eget</h5>
        <p>$400</p>
        <a href="#" class="button small expanded hollow">Buy</a>
      </div>
      <div class="column">
        <img class="thumbnail" src="http://placehold.it/300x400">
        <h5>Nulla At Nulla Justo, Eget</h5>
        <p>$400</p>
        <a href="#" class="button small expanded hollow">Buy</a>
      </div>
      <div class="column">
        <img class="thumbnail" src="http://placehold.it/300x400">
        <h5>Nulla At Nulla Justo, Eget</h5>
        <p>$400</p>
        <a href="#" class="button small expanded hollow">Buy</a>
      </div>
      <div class="column">
        <img class="thumbnail" src="http://placehold.it/300x400">
        <h5>Nulla At Nulla Justo, Eget</h5>
        <p>$400</p>
        <a href="#" class="button small expanded hollow">Buy</a>
      </div>
    </div>

    <hr>
    <div class="row">
      <div class="medium-4 columns">
        <h4>Top Products</h4>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
      </div>
      <div class="medium-4 columns">
        <h4>Top Products</h4>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
      </div>
      <div class="medium-4 columns">
        <h4>Top Products</h4>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
        <div class="media-object">
          <div class="media-object-section">
            <img class="thumbnail" src="http://placehold.it/100x100">
          </div>
          <div class="media-object-section">
            <h5>Nunc Eu Ullamcorper Orci</h5>
            <p>Quisque eget odio ac lectus vestibulum faucibus eget in metus. In pellentesque.</p>
          </div>
        </div>
      </div>
    </div>
	}
